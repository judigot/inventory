!function(t){t.widget("extend.sorttable",t.ui.sortable,{widgetEventPrefix:"sorttable",options:{helper:"table",helperCells:1},_table:null,_startIndex:0,_endIndex:0,_currentItemWidth:0,_sortCells:null,_createHelper:function(e){if("table"==this.options.helper){if(!this.setWidths){this.setWidths=!0;var r=this.items,n=[];for(i=0;i<r.length;i++){s=t(r[i].item[0]);n[i]=s.innerWidth()-parseInt(s.css("paddingLeft")||0,10)-parseInt(s.css("paddingRight")||0,10)}for(i=0;i<r.length;i++){var s;(s=t(r[i].item[0])).width(n[i])}}return this._createHelperTable(e,this.currentItem)}return t.ui.sortable.prototype._createHelper.apply(this,[e])},_createHelperTable:function(e,r){var n=this.options.helperCells,s=r.is("th")||r.is("td")?r:r.parents("th:first,td:first"),a=s.prevAll().length+1,l=s.innerWidth()-parseInt(s.css("paddingLeft")||0,10)-parseInt(s.css("paddingRight")||0,10);this._currentItemWidth=l;var o,h=this._table;"number"==typeof n&&(o=n);var d=t([]);1!=o&&(d=h.children().find(">tr:not(.ui-sortable)>td:nth-child("+a+")"),o<0?d=d.slice(0,d.length+o):o>1&&(d=d.slice(0,o-1))),!o&&n&&(d=d.filter(n)),d.splice(0,0,s),this._sortCells=d;var p=h.clone().empty();for(p.css("position","absolute"),p.css("width","auto"),p.css("min-width","inherit"),p.css("height","auto"),p.css("min-height","inherit"),p.attr("id",""),i=0;i<d.length;i++){var c=d[i];c instanceof jQuery||(c=t(c));var f=c.parents("tr:first"),u=c.clone();u.width(l);var _=f.clone().empty(),b=f.innerHeight()-parseInt(f.css("paddingTop")||0,10)-parseInt(f.css("paddingBottom")||0,10);_.height(b),u.appendTo(_.appendTo(p))}return p.find().each(function(){this.attr("id","")}),h.before(p),p},_createPlaceholder:function(e){var i=e||this,r=i.options;if(t.ui.sortable.prototype._createPlaceholder.apply(this,arguments),"table"==r.helper){var n=i.placeholder;i.placeholder.width(i._currentItemWidth);var s=i._sortCells;s&&(s.hide(),s.length>1&&n.attr("rowSpan",s.length));var a=i._placeholderRowSpan;a>1&&n.attr("rowSpan",a)}},_swapNodes:function(t,e){if(t&&e){var i=t.parentNode,r=t.nextSibling===e?t:t.nextSibling;e.parentNode.insertBefore(t,e),i.insertBefore(e,r)}},_bubbleCols:function(){var t=this._startIndex,e=this._endIndex,i=this._table.children().find("> tr:not(.ui-sortable)");if(t<e)for(a=t;a<e;a++)for(var r=i.find(">td:nth-child("+a+"),>th:nth-child("+a+")"),n=i.find(">td:nth-child("+(a+1)+"),>th:nth-child("+(a+1)+")"),s=0;s<r.length;s++)this._swapNodes(r[s],n[s]);else for(var a=t;a>e;a--)for(var r=i.find(">td:nth-child("+a+"),>th:nth-child("+a+")"),n=i.find(">td:nth-child("+(a-1)+"),>th:nth-child("+(a-1)+")"),s=0;s<r.length;s++)this._swapNodes(r[s],n[s])},_rearrangeTableBackroundProcessing:function(){var t=this;return function(){t._bubbleCols()}},_sortStart:function(){var t=this;return function(e,i){t._startIndex=i.item.prevAll().length+1}},_sortUpdate:function(){var t=this;return function(e,i){t._endIndex=i.item.prevAll().length+1,t._startIndex!=t._endIndex&&setTimeout(t._rearrangeTableBackroundProcessing(),50)}},_sortStop:function(){var t=this;return function(e,i){t._sortCells&&t._sortCells.show()}},_create:function(){var e=this.element;e.is("table")?(this._table=e,e=this.element=e.find("tr:first")):this._table=e.parents("table:first"),this._startIndex=0,this._endIndex=0,e.bind("sorttablestart",this._sortStart()),e.bind("sorttableupdate",this._sortUpdate()),e.bind("sorttablestop",this._sortStop()),t.ui.sortable.prototype._create.apply(this)},destroy:function(){t.Widget.prototype.destroy.apply(this,arguments)}})}(jQuery);